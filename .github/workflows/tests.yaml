name: Guardian-Flow CI Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # 1. KodlarÄ± Ã§ek
    - uses: actions/checkout@v3

    # 2. Python Kur
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"

    # 3. KÃ¼tÃ¼phaneleri YÃ¼kle
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install httpx pytest

    # 4. Modeli SÄ±fÄ±rdan OluÅŸtur (CI OrtamÄ±nda)
    - name: Build Model from Scratch
      run: |
        echo "ğŸ² Sentetik veri Ã¼retiliyor..."
        python src/data/make_dataset.py
        
        echo "ğŸ§¹ Veri iÅŸleniyor..."
        python src/data/preprocess.py
        
        echo "ğŸ‹ï¸ Model eÄŸitiliyor..."
        python src/models/train_model.py
        
        echo "âœ… Model dosyasÄ± oluÅŸturuldu:"
        ls -l models/

    # 5. Testleri Ã‡alÄ±ÅŸtÄ±r
    - name: Run Tests with Pytest
      run: |
        python -m pytest